<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Certificat de Scolarit√©</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- html2canvas for download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Fonts - Signature style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

    <!-- Base64 Logos (√©vite CORS) -->
    <script src="assets/js/logos.js"></script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1F2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6B7280;
        }

        /* Print styles for certificate */
        @media print {
            body {
                background: white;
            }

            .certificate-page {
                box-shadow: none;
                margin: 0;
                width: 100%;
                max-width: 100%;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }

        /* Certificate page styling */
        .certificate-page {
            font-family: 'Arial', sans-serif;
            width: 210mm;
            min-height: 297mm;
        }

        /* Pay stub page styling */
        .paystub-page {
            font-family: Arial, sans-serif;
            background-color: white;
            width: 850px;
            padding: 40px;
            box-sizing: border-box;
        }

        /* Mode Toggle Styles */
        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 1.5rem;
            background: rgba(31, 41, 55, 0.8);
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-btn {
            padding: 10px 24px;
            border: none;
            background: transparent;
            color: #9ca3af;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .mode-btn:hover {
            color: #e5e7eb;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        /* Input focus effect */
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            ring: 2px;
            ring-color: #6366f1;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-slate-800 min-h-screen text-white">

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1
                class="text-4xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent mb-2">
                <i class="fas fa-graduation-cap mr-3"></i>G√©n√©rateur de Certificat
            </h1>
            <p class="text-gray-400">Cr√©ez des certificats de scolarit√© professionnels en quelques clics</p>

            <!-- Mode Toggle -->
            <div class="mode-toggle mt-4">
                <button id="modeFR" class="mode-btn active" onclick="switchMode('FR')">
                    üá´üá∑ Certificat FR
                </button>
                <button id="modeK12" class="mode-btn" onclick="switchMode('K12')">
                    üá∫üá∏ Pay Stub K12
                </button>
            </div>
        </header>

        <!-- Main Content - Two Columns -->
        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Left Column - Form -->
            <div
                class="w-full lg:w-2/5 bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/50 shadow-2xl">

                <!-- Generate Random Button - TOP -->
                <button id="randomizeAllBtn"
                    class="w-full mb-6 px-6 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-xl shadow-lg hover:from-indigo-700 hover:to-purple-700 hover:scale-[1.02] hover:shadow-xl active:scale-[0.98] transition-all duration-300">
                    <i class="fas fa-shuffle mr-2"></i>G√©n√©rer Al√©atoirement
                </button>

                <!-- FR Form -->
                <div id="formFR" class="space-y-4">
                    <!-- √âtablissement Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-indigo-400 mb-4"><i
                                class="fas fa-building-columns mr-2"></i>√âtablissement</h3>

                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-image mr-2 text-yellow-400"></i>Logo
                                </label>
                                <input type="text" id="logoFilename" readonly
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-sm text-gray-300 cursor-default"
                                    placeholder="S√©lection automatique...">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-school mr-2 text-blue-400"></i>Nom de l'√©tablissement
                                </label>
                                <input type="text" id="nomEtablissement"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/50 transition-all"
                                    placeholder="Lyc√©e Exemple">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-location-dot mr-2 text-red-400"></i>Adresse
                                </label>
                                <input type="text" id="adresseEtablissement"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                    placeholder="123 Rue de l'√âcole, 75000 Paris">
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-barcode mr-2 text-green-400"></i>RNE
                                    </label>
                                    <input type="text" id="rne"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                        placeholder="0141169V">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-phone mr-2 text-cyan-400"></i>T√©l√©phone
                                    </label>
                                    <input type="text" id="telephone"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                        placeholder="01 23 45 67 89">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √âtudiant Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-purple-400 mb-4"><i
                                class="fas fa-user-graduate mr-2"></i>√âtudiant</h3>

                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-user mr-2 text-pink-400"></i>Nom
                                    </label>
                                    <input type="text" id="nomEtudiant"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                        placeholder="DUPONT">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-user mr-2 text-pink-400"></i>Pr√©nom
                                    </label>
                                    <input type="text" id="prenomEtudiant"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                        placeholder="Jean">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-cake-candles mr-2 text-orange-400"></i>Date de naissance
                                </label>
                                <input type="date" id="dateNaissance" title="Date de naissance"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-id-card mr-2 text-teal-400"></i>Identifiant National (INE)
                                </label>
                                <input type="text" id="ine"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                    placeholder="120638936GB">
                            </div>
                        </div>
                    </div>

                    <!-- Scolarit√© Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-cyan-400 mb-4"><i class="fas fa-book mr-2"></i>Scolarit√©
                        </h3>

                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-graduation-cap mr-2 text-purple-400"></i>Niveau d'√©tudes
                                </label>
                                <select id="matiere" title="Niveau d'√©tudes"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all">
                                    <option value="Licence 1">Licence 1</option>
                                    <option value="Licence 2">Licence 2</option>
                                    <option value="Licence 3">Licence 3</option>
                                    <option value="Master 1">Master 1</option>
                                    <option value="Master 2">Master 2</option>
                                    <option value="Doctorat">Doctorat</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-calendar-alt mr-2 text-violet-400"></i>Ann√©e scolaire
                                </label>
                                <input type="text" id="anneeScolaire"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                    placeholder="2025 - 2026">
                            </div>
                        </div>
                    </div>

                    <!-- Signature Section -->
                    <div>
                        <h3 class="text-lg font-semibold text-emerald-400 mb-4"><i
                                class="fas fa-signature mr-2"></i>Signature</h3>

                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">
                                    <i class="fas fa-user-tie mr-2 text-lime-400"></i>Nom du Directeur
                                </label>
                                <input type="text" id="nomDirecteur"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                    placeholder="M. MARTIN">
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-city mr-2 text-sky-400"></i>Ville
                                    </label>
                                    <input type="text" id="villeSignature"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all"
                                        placeholder="Paris">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">
                                        <i class="fas fa-calendar mr-2 text-rose-400"></i>Date
                                    </label>
                                    <input type="date" id="dateSignature" title="Date de signature"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:border-indigo-500 transition-all">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- K12 Form (hidden by default) -->
                <div id="formK12" class="space-y-4" style="display: none;">
                    <!-- School Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-emerald-400 mb-4"><i class="fas fa-school mr-2"></i>School
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">School Name</label>
                                <input type="text" id="k12SchoolName"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                    placeholder="Q300 Lower Division">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Address</label>
                                <input type="text" id="k12SchoolAddress"
                                    class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                    placeholder="28-37 29th St, Long Island City, NY">
                            </div>
                        </div>
                    </div>

                    <!-- Employee Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-purple-400 mb-4"><i
                                class="fas fa-user-tie mr-2"></i>Employee</h3>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Full Name</label>
                                    <input type="text" id="k12EmpName"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        placeholder="John Smith">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Employee ID</label>
                                    <input type="text" id="k12EmpId"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        placeholder="003618">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Department</label>
                                    <select id="k12Department"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg">
                                        <option>Mathematics Department</option>
                                        <option>English Department</option>
                                        <option>Science Department</option>
                                        <option>History Department</option>
                                        <option>Art Department</option>
                                        <option>Physical Education</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Position</label>
                                    <select id="k12Position"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg">
                                        <option>Teacher</option>
                                        <option>Assistant Principal</option>
                                        <option>Counselor</option>
                                        <option>Librarian</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Earnings Section -->
                    <div class="border-b border-gray-700 pb-4 mb-4">
                        <h3 class="text-lg font-semibold text-green-400 mb-4"><i
                                class="fas fa-dollar-sign mr-2"></i>Earnings</h3>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Base Salary ($)</label>
                                    <input type="number" id="k12BaseSalary"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        value="5000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Bonus ($)</label>
                                    <input type="number" id="k12Bonus"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        value="300">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Overtime Hours</label>
                                    <input type="number" id="k12OvertimeHours"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        value="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Overtime Rate
                                        ($/hr)</label>
                                    <input type="number" id="k12OvertimeRate"
                                        class="w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg"
                                        value="40">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Download Button -->
                <button id="downloadBtn"
                    class="w-full mt-6 px-6 py-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold rounded-xl shadow-lg hover:from-emerald-700 hover:to-teal-700 hover:scale-[1.02] hover:shadow-xl active:scale-[0.98] transition-all duration-300">
                    <i class="fas fa-download mr-2"></i>T√©l√©charger en Image
                </button>
            </div>

            <!-- Right Column - Preview -->
            <div class="w-full lg:w-3/5 flex flex-col items-center">
                <h2 class="text-2xl font-bold text-gray-300 mb-4"><i class="fas fa-eye mr-2"></i>Aper√ßu du Certificat
                </h2>

                <div id="certificateContainer" class="bg-gray-100 p-4 rounded-2xl shadow-2xl">
                    <!-- Certificate Preview - New Model -->
                    <div id="certificate" class="certificate-page bg-[#f5f5dc] p-[40px] shadow-xl text-gray-900"
                        style="font-family: 'Times New Roman', serif; line-height: 2.2;">

                        <!-- Header -->
                        <div class="text-center mb-8">
                            <h3 class="text-base font-normal m-0" id="certNomEtab">ACAD√âMIE DE PARIS</h3>
                            <h3 class="text-base font-normal m-0" id="certAdresse">12 Boulevard d'Indochine, 75019 Paris
                            </h3>
                            <hr class="w-12 mx-auto my-3 border-black">
                            <h1 class="text-2xl font-bold underline my-5">CERTIFICAT DE SCOLARITE</h1>
                            <h2 class="text-lg font-normal my-4">ANNEE SCOLAIRE <span id="certAnnee">2025 - 2026</span>
                            </h2>
                        </div>

                        <!-- Content -->
                        <div class="content">
                            <p class="m-0">Je soussign√© <span id="certSoussigne">Directeur</span> <span
                                    id="certDirecteurIntro" class="font-medium">"Nom directeur"</span></p>
                            <p class="m-0">Certifie que <span id="certIlElle">le</span> nomm√©(e) <span
                                    id="certNomPrenom" class="font-medium">"NOM Pr√©nom"</span></p>
                            <p class="m-0">Ag√©(e) de <span id="certAge" class="font-medium">"18"</span> ans</p>
                            <p class="m-0">suit assid√ªment les cours de <span id="certMatiere"
                                    class="font-medium">"Terminale G√©n√©rale"</span></p>
                            <p class="m-0">dans mon √©tablissement o√π il/elle est inscrit(e) depuis</p>
                            <p class="m-0">le <span id="certDateInscription" class="font-medium">01/09/2025</span>
                                expire le <span id="certDateExpiration" class="font-medium">30/06/2026</span></p>
                        </div>

                        <!-- Certification Box -->
                        <div class="my-5 pl-4 border-l-2 border-black" style="line-height: 2;">
                            <p class="m-0">Je certifie</p>
                            <p class="m-0">qu'<span id="certIlElle2">il</span> ne b√©n√©ficie pas (1)</p>
                            <p class="m-0">qu'<span id="certIlElle3">il</span> b√©n√©ficie (1) d'une bourse d'entretien
                            </p>
                        </div>

                        <!-- Footer -->
                        <div class="flex justify-between mt-20">
                            <!-- Left Footer -->
                            <div class="w-[48%]">
                                <div class="mb-6">
                                    <p class="m-0"><small>(Nom-Pr√©noms-Titre<br>et qualit√© du Signataire)</small></p>
                                </div>

                                <div class="mt-6">
                                    <p class="m-0 font-bold">Mode de paiement</p>
                                    <p class="m-0 font-bold">Virement - Ch√®que - Esp√®ces</p>
                                </div>

                                <div class="mt-8">
                                    <p class="m-0"><small>N¬∞ d'Immatriculation √† la CAF ou<br>S√©curit√© Sociale du
                                            responsable l√©gal</small></p>
                                    <p class="mt-5"><span id="certNumImmat" class="text-red-600 font-medium">"num√©ro
                                            al√©atoire"</span></p>
                                </div>
                            </div>

                            <!-- Right Footer -->
                            <div class="w-[48%] text-center">
                                <p class="m-0">Fait √† <span id="certVille" class="font-medium">Paris</span></p>
                                <p class="m-0">Le <span id="certDateSignature" class="font-medium">09/12/2025</span></p>
                                <p class="mt-8 font-bold">Signature et cachet</p>
                                <div class="border border-black p-4 mt-5 min-h-[80px] flex items-center justify-center">
                                    <span id="certSignature" class="text-2xl text-blue-900"
                                        style="font-family: 'Dancing Script', cursive;">Signature</span>
                                </div>
                            </div>
                        </div>

                        <p class="text-sm text-center mt-16">(1) Rayer la mention inutile</p>
                    </div>
                </div>

                <!-- K12 Pay Stub Preview (hidden by default) -->
                <div id="paystubContainer" class="bg-gray-100 p-4 rounded-2xl shadow-2xl" style="display: none;">
                    <div id="paystub" class="paystub-page"
                        style="font-family: Arial, sans-serif; background-color: white; color: black; width: 850px; padding: 40px; box-sizing: border-box; box-shadow: 0 0 10px rgba(0,0,0,0.1);">

                        <!-- NYC DOE Header -->
                        <div
                            style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #003366; padding-bottom: 15px;">
                            <div style="font-size: 14px; color: #003366; font-weight: bold; margin-bottom: 5px;">NEW
                                YORK CITY DEPARTMENT OF EDUCATION</div>
                            <div id="k12Logo" style="font-size: 28px; font-weight: bold; color: #000; margin: 10px 0;">
                                Q300 - THE SCHOOL FOR MATH, SCIENCE & TECHNOLOGY
                            </div>
                            <div id="k12CompanyAddress" style="font-size: 12px; color: #555;">28-37 29th Street, Long
                                Island City, NY 11102 ‚Ä¢ District 30</div>
                        </div>

                        <!-- Document Title -->
                        <div
                            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                            <div style="width: 50%;">
                                <div style="font-size: 11px; color: #666;">School Name:</div>
                                <div id="k12CompanyName" style="font-size: 14px; font-weight: bold;">Q300 Lower Division
                                    (Queens, NY)</div>
                            </div>
                            <div
                                style="border: 2px solid #003366; color: #003366; padding: 10px 20px; font-weight: bold; font-size: 20px; text-align: center; text-transform: uppercase;">
                                EARNINGS<br>STATEMENT
                            </div>
                        </div>

                        <!-- Info Section -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <div style="border: 1px solid #999; width: 48%;">
                                <div
                                    style="background-color: #f9f9f9; font-weight: bold; padding: 5px 10px; border-bottom: 1px solid #999;">
                                    EMPLOYEE INFORMATION</div>
                                <div style="padding: 10px; line-height: 1.6; font-size: 14px;">
                                    <strong>Name:</strong> <span id="k12DisplayName">Sopalai San</span><br>
                                    <strong>Employee ID:</strong> <span id="k12DisplayId">003618</span><br>
                                    <strong>Department:</strong> <span id="k12DisplayDept">Mathematics
                                        Department</span><br>
                                    <strong>Position:</strong> <span id="k12DisplayPosition">Teacher</span><br>
                                    <strong>Status:</strong> Full-time Active Faculty
                                </div>
                            </div>
                            <div style="border: 1px solid #999; width: 48%;">
                                <div
                                    style="background-color: #f9f9f9; font-weight: bold; padding: 5px 10px; border-bottom: 1px solid #999;">
                                    PAY SUMMARY</div>
                                <div style="padding: 10px; line-height: 1.6; font-size: 14px;">
                                    <strong>Pay Period:</strong> <span id="k12PayPeriod">2025-09-01 ‚Äî
                                        2025-11-30</span><br>
                                    <strong>Pay Date:</strong> <span id="k12PayDate">2025-11-30</span>
                                </div>
                            </div>
                        </div>

                        <!-- Main Table -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 14px;">
                            <thead>
                                <tr>
                                    <th colspan="4"
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: left;">
                                        EARNINGS</th>
                                    <th colspan="2"
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: left;">
                                        DEDUCTIONS</th>
                                </tr>
                                <tr>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; width: 25%;">
                                        Description</th>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: center;">
                                        Hours</th>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: center;">
                                        Rate</th>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: right;">
                                        Amount</th>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; width: 25%;">
                                        Description</th>
                                    <th
                                        style="border: 1px solid #999; padding: 6px 8px; background-color: #dcdcdc; text-align: right;">
                                        Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Base Salary</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px; text-align: center;">-</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px; text-align: center;">-</td>
                                    <td id="k12DisplaySalary"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$5,000.00
                                    </td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Federal Tax</td>
                                    <td id="k12FedTax"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$850.00
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Overtime</td>
                                    <td id="k12DisplayOTHours"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: center;">10</td>
                                    <td id="k12DisplayOTRate"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: center;">$40/hr
                                    </td>
                                    <td id="k12DisplayOTAmount"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$400.00
                                    </td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">State Tax</td>
                                    <td id="k12StateTax"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$240.00
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Bonus</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px; text-align: center;">-</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px; text-align: center;">-</td>
                                    <td id="k12DisplayBonus"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$300.00
                                    </td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Social Security</td>
                                    <td id="k12SS" style="border: 1px solid #999; padding: 6px 8px; text-align: right;">
                                        $353.40</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">&nbsp;</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Medicare</td>
                                    <td id="k12Medicare"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$82.65</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">&nbsp;</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Health Insurance</td>
                                    <td id="k12Health"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$150.00
                                    </td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">&nbsp;</td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Retirement (401k)</td>
                                    <td id="k12Retirement"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$200.00
                                    </td>
                                </tr>
                                <tr style="font-weight: bold;">
                                    <td colspan="2" style="border: none;"></td>
                                    <td style="border: 1px solid #999; padding: 6px 8px; text-align: right;">Total:</td>
                                    <td id="k12TotalEarnings"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$5,700.00
                                    </td>
                                    <td style="border: 1px solid #999; padding: 6px 8px;">Total Deductions:</td>
                                    <td id="k12TotalDeductions"
                                        style="border: 1px solid #999; padding: 6px 8px; text-align: right;">$1,876.05
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Footer Section -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="width: 40%;">
                                <div
                                    style="font-weight: bold; margin-bottom: 5px; text-transform: uppercase; font-size: 14px;">
                                    YEAR-TO-DATE (YTD)</div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                    <tr>
                                        <td style="border: 1px solid #999; padding: 5px;">YTD Gross Pay:</td>
                                        <td id="k12YTDGross"
                                            style="border: 1px solid #999; padding: 5px; text-align: right;">$11,400.00
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #999; padding: 5px;">YTD Deductions:</td>
                                        <td id="k12YTDDeductions"
                                            style="border: 1px solid #999; padding: 5px; text-align: right;">$3,752.10
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #999; padding: 5px; font-weight: bold;">YTD Net
                                            Pay:</td>
                                        <td id="k12YTDNet"
                                            style="border: 1px solid #999; padding: 5px; text-align: right; font-weight: bold;">
                                            $7,647.90</td>
                                    </tr>
                                </table>
                            </div>
                            <div style="width: 40%;">
                                <div
                                    style="font-weight: bold; margin-bottom: 5px; text-transform: uppercase; font-size: 14px;">
                                    NET PAY DISTRIBUTION</div>
                                <div id="k12NetPay"
                                    style="background-color: #2b5c22; color: white; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; border: 1px solid black;">
                                    $3,823.95</div>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <div
                            style="margin-top: 40px; font-size: 10px; color: #666; text-align: center; font-style: italic; border: 1px solid #ccc; padding: 5px;">
                            This document is a representation of earnings and deductions for the period specified.
                            Please retain for your records.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== EMBEDDED DATA (pour √©viter les erreurs CORS avec file://) ==========
        const etudiantsData = {
            "prenoms": {
                "masculins": [
                    "Lucas", "Hugo", "Louis", "Gabriel", "Rapha√´l",
                    "Arthur", "Jules", "Adam", "L√©o", "Noah",
                    "Th√©o", "Nathan", "Mathis", "Maxime", "Alexandre",
                    "Antoine", "Baptiste", "Cl√©ment", "Enzo", "√âtienne",
                    "Florian", "Guillaume", "Julien", "Kevin", "L√©on",
                    "Mathieu", "Nicolas", "Pierre", "Quentin", "Romain",
                    "S√©bastien", "Thomas", "Victor", "Xavier", "Yann"
                ],
                "feminins": [
                    "Emma", "Louise", "Jade", "Alice", "Chlo√©",
                    "L√©a", "Manon", "In√®s", "Camille", "Sarah",
                    "Anna", "Lina", "Mila", "Rose", "Zo√©",
                    "Am√©lie", "Charlotte", "Clara", "√âlise", "Eva",
                    "Juliette", "Laura", "L√©onie", "Lucie", "Marie",
                    "Margot", "Nina", "Oc√©ane", "Pauline", "Sophie",
                    "Val√©rie", "Victoire", "Yasmine", "Ana√Øs", "C√©lia"
                ]
            },
            "noms": [
                "Martin", "Bernard", "Dubois", "Thomas", "Robert",
                "Richard", "Petit", "Durand", "Leroy", "Moreau",
                "Simon", "Laurent", "Lefebvre", "Michel", "Garcia",
                "David", "Bertrand", "Roux", "Vincent", "Fournier",
                "Morel", "Girard", "Andr√©", "Lef√®vre", "Mercier",
                "Dupont", "Lambert", "Bonnet", "Fran√ßois", "Martinez",
                "Legrand", "Garnier", "Faure", "Rousseau", "Blanc",
                "Guerin", "Muller", "Henry", "Roussel", "Nicolas",
                "Perrin", "Morin", "Mathieu", "Cl√©ment", "Gauthier",
                "Dumont", "Lopez", "Fontaine", "Chevalier", "Robin"
            ]
        };

        const universitesData = {
            "universites": [
                { "nom": "Universit√© Paris-Saclay", "adresse": "3 Rue Joliot Curie, 91190 Gif-sur-Yvette", "ville": "Paris", "logo": "assets/logos/paris-saclay.svg" },
                { "nom": "Sorbonne Universit√©", "adresse": "21 Rue de l'√âcole de M√©decine, 75006 Paris", "ville": "Paris", "logo": "assets/logos/sorbonne.svg" },
                { "nom": "Universit√© Paris Cit√©", "adresse": "85 Boulevard Saint-Germain, 75006 Paris", "ville": "Paris", "logo": "assets/logos/paris-cite.svg" },
                { "nom": "Universit√© Claude Bernard Lyon 1", "adresse": "43 Boulevard du 11 Novembre 1918, 69100 Villeurbanne", "ville": "Lyon", "logo": "assets/logos/lyon.svg" },
                { "nom": "Universit√© Lumi√®re Lyon 2", "adresse": "86 Rue Pasteur, 69007 Lyon", "ville": "Lyon", "logo": "assets/logos/lyon.svg" },
                { "nom": "Aix-Marseille Universit√©", "adresse": "58 Boulevard Charles Livon, 13007 Marseille", "ville": "Marseille", "logo": "assets/logos/aix-marseille.svg" },
                { "nom": "Universit√© de Nantes", "adresse": "1 Quai de Tourville, 44000 Nantes", "ville": "Nantes", "logo": "assets/logos/nantes.svg" },
                { "nom": "Universit√© de Bordeaux", "adresse": "35 Place Pey Berland, 33000 Bordeaux", "ville": "Bordeaux", "logo": "assets/logos/bordeaux.svg" },
                { "nom": "Universit√© Toulouse III - Paul Sabatier", "adresse": "118 Route de Narbonne, 31062 Toulouse", "ville": "Toulouse", "logo": "assets/logos/toulouse.svg" },
                { "nom": "Universit√© de Lille", "adresse": "42 Rue Paul Duez, 59000 Lille", "ville": "Lille", "logo": "assets/logos/lille.svg" },
                { "nom": "Universit√© de Strasbourg", "adresse": "4 Rue Blaise Pascal, 67000 Strasbourg", "ville": "Strasbourg", "logo": "assets/logos/strasbourg.svg" },
                { "nom": "Universit√© Grenoble Alpes", "adresse": "621 Avenue Centrale, 38400 Saint-Martin-d'H√®res", "ville": "Grenoble", "logo": "assets/logos/grenoble.svg" },
                { "nom": "Universit√© C√¥te d'Azur", "adresse": "28 Avenue Valrose, 06108 Nice", "ville": "Nice", "logo": "assets/logos/nice.svg" },
                { "nom": "Universit√© de Montpellier", "adresse": "163 Rue Auguste Broussonnet, 34090 Montpellier", "ville": "Montpellier", "logo": "assets/logos/montpellier.svg" },
                { "nom": "Universit√© de Lorraine", "adresse": "34 Cours L√©opold, 54000 Nancy", "ville": "Nancy", "logo": "assets/logos/lorraine.svg" },
                { "nom": "Universit√© de Rennes 1", "adresse": "2 Rue du Thabor, 35000 Rennes", "ville": "Rennes", "logo": "assets/logos/rennes.svg" }
            ]
        };

        // Liste de tous les logos disponibles
        const availableLogos = [
            "assets/logos/aix-marseille.svg",
            "assets/logos/bordeaux.svg",
            "assets/logos/grenoble.svg",
            "assets/logos/lille.svg",
            "assets/logos/lorraine.svg",
            "assets/logos/lyon.svg",
            "assets/logos/montpellier.svg",
            "assets/logos/nantes.svg",
            "assets/logos/nice.svg",
            "assets/logos/paris-cite.svg",
            "assets/logos/paris-saclay.svg",
            "assets/logos/rennes.svg",
            "assets/logos/sorbonne.svg",
            "assets/logos/strasbourg.svg",
            "assets/logos/toulouse.svg"
        ];

        // ========== K12 DATA (US Schools) ==========
        const k12Data = {
            firstNames: [
                "James", "John", "Robert", "Michael", "William", "David", "Richard", "Joseph",
                "Mary", "Patricia", "Jennifer", "Linda", "Elizabeth", "Barbara", "Susan", "Jessica",
                "Sarah", "Karen", "Nancy", "Lisa", "Margaret", "Betty", "Sandra", "Ashley"
            ],
            lastNames: [
                "Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis",
                "Rodriguez", "Martinez", "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson",
                "Thomas", "Taylor", "Moore", "Jackson", "Martin", "Lee", "Perez", "Thompson"
            ],
            departments: [
                "Mathematics Department", "English Department", "Science Department",
                "History Department", "Art Department", "Physical Education",
                "Music Department", "Foreign Languages", "Special Education"
            ],
            positions: ["Teacher", "Assistant Principal", "Counselor", "Librarian", "Department Head"],
            schools: [
                { name: "Q300 Lower Division", address: "28-37 29th St, Long Island City, NY 11102", logo: "Q300" },
                { name: "PS 234 Independence School", address: "292 Greenwich St, New York, NY 10007", logo: "PS234" },
                { name: "Brooklyn Tech High School", address: "29 Fort Greene Pl, Brooklyn, NY 11217", logo: "BTHS" },
                { name: "Stuyvesant High School", address: "345 Chambers St, New York, NY 10282", logo: "STUY" },
                { name: "Bronx High School of Science", address: "75 W 205th St, Bronx, NY 10468", logo: "BxSCI" }
            ]
        };

        // ========== MODE MANAGEMENT ==========
        let currentMode = 'FR'; // 'FR' or 'K12'

        function switchMode(mode) {
            currentMode = mode;

            // Toggle form visibility
            document.getElementById('formFR').style.display = mode === 'FR' ? 'block' : 'none';
            document.getElementById('formK12').style.display = mode === 'K12' ? 'block' : 'none';

            // Toggle preview visibility
            document.getElementById('certificateContainer').style.display = mode === 'FR' ? 'block' : 'none';
            document.getElementById('paystubContainer').style.display = mode === 'K12' ? 'block' : 'none';

            // Update button states
            document.getElementById('modeFR').classList.toggle('active', mode === 'FR');
            document.getElementById('modeK12').classList.toggle('active', mode === 'K12');

            // Generate random data for the new mode
            if (mode === 'FR') {
                generateRandom();
            } else {
                generateRandomK12();
            }
        }

        // ========== RANDOM HELPERS ==========
        function randomFromArray(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function padZero(num, size) {
            return String(num).padStart(size, '0');
        }

        // ========== GENERATE RNE ==========
        function generateRNE() {
            // D√©partement (01-95 ou 971-976)
            const dept = padZero(randomInt(1, 95), 3);
            // Num√©ro ordre
            const ordre = padZero(randomInt(1, 9999), 4);
            // Cl√© de contr√¥le (lettre)
            const numTotal = parseInt(dept + ordre);
            const cle = String.fromCharCode(65 + (numTotal % 23)); // A-W (skip I, O, Q)
            return dept + ordre + cle;
        }

        // ========== GENERATE INE ==========
        function generateINE(birthYear) {
            // Les 2 premiers chiffres = ann√©e entr√©e maternelle (naissance + 3)
            const entreeMaternelle = (birthYear + 3) % 100;
            const prefix = padZero(entreeMaternelle, 2);

            // 7 chiffres al√©atoires
            const random7 = padZero(randomInt(0, 9999999), 7);

            // Num√©ro complet (9 chiffres)
            const number9 = prefix + random7;

            // Calcul cl√© modulo 97
            const reste = parseInt(number9) % 97;
            const cleNum = 97 - reste;

            // Conversion en 2 lettres
            const lettre1 = String.fromCharCode(65 + Math.floor(cleNum / 10));
            const lettre2 = String.fromCharCode(65 + (cleNum % 10));

            return number9 + lettre1 + lettre2;
        }

        // ========== GENERATE PHONE ==========
        function generatePhone() {
            const prefixes = ['01', '02', '03', '04', '05'];
            const prefix = randomFromArray(prefixes);
            const nums = [];
            for (let i = 0; i < 4; i++) {
                nums.push(padZero(randomInt(0, 99), 2));
            }
            return prefix + ' ' + nums.join(' ');
        }

        // ========== FORMAT DATE ==========
        function formatDateFR(dateStr) {
            const date = new Date(dateStr);
            const day = padZero(date.getDate(), 2);
            const month = padZero(date.getMonth() + 1, 2);
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // ========== GENERATE RANDOM DATA ==========
        function generateRandom() {
            console.log('üé≤ G√©n√©ration al√©atoire...');

            // Random gender
            const isMale = Math.random() > 0.5;
            const prenoms = isMale ? etudiantsData.prenoms.masculins : etudiantsData.prenoms.feminins;

            // Random student
            const prenom = randomFromArray(prenoms);
            const nom = randomFromArray(etudiantsData.noms);

            // Random university
            const universite = randomFromArray(universitesData.universites);

            // Random birth date (1999-2006 = 18-25 ans pour √©tudiants universitaires)
            const birthYear = randomInt(1999, 2006);
            const birthMonth = padZero(randomInt(1, 12), 2);
            const birthDay = padZero(randomInt(1, 28), 2);
            const birthDate = `${birthYear}-${birthMonth}-${birthDay}`;

            // Random director (with gender)
            const directorIsMale = Math.random() > 0.5;
            const directorNom = randomFromArray(etudiantsData.noms);
            const directorPrefix = directorIsMale ? 'M.' : 'Mme';
            window.currentDirectorIsMale = directorIsMale; // Stocker pour updatePreview

            // Set today's date for signature
            const today = new Date().toISOString().split('T')[0];

            // Get logo filename based on city
            const cityToLogo = {
                'Paris': 'paris-saclay.svg',
                'Lyon': 'lyon.svg',
                'Marseille': 'aix-marseille.svg',
                'Nantes': 'nantes.svg',
                'Bordeaux': 'bordeaux.svg',
                'Toulouse': 'toulouse.svg',
                'Lille': 'lille.svg',
                'Strasbourg': 'strasbourg.svg',
                'Grenoble': 'grenoble.svg',
                'Nice': 'nice.svg',
                'Montpellier': 'montpellier.svg',
                'Nancy': 'lorraine.svg',
                'Rennes': 'rennes.svg'
            };
            const logoFilename = cityToLogo[universite.ville] || 'sorbonne.svg';

            // Fill form
            document.getElementById('nomEtablissement').value = universite.nom;
            document.getElementById('adresseEtablissement').value = universite.adresse;
            document.getElementById('rne').value = generateRNE();
            document.getElementById('telephone').value = generatePhone();
            document.getElementById('nomEtudiant').value = nom.toUpperCase();
            document.getElementById('prenomEtudiant').value = prenom;
            document.getElementById('dateNaissance').value = birthDate;
            document.getElementById('ine').value = generateINE(birthYear);
            document.getElementById('matiere').value = randomFromArray(['Licence 1', 'Licence 2', 'Licence 3', 'Master 1', 'Master 2']);
            document.getElementById('anneeScolaire').value = '2025 - 2026';
            document.getElementById('nomDirecteur').value = `${directorPrefix} ${directorNom.toUpperCase()}`;
            document.getElementById('villeSignature').value = universite.ville;
            document.getElementById('dateSignature').value = today;
            document.getElementById('logoFilename').value = logoFilename;

            // Store student gender for preview
            window.currentStudentIsMale = isMale;

            // Display logo from university (avec rasterisation Base64 ‚Üí PNG)
            const logoPath = `assets/logos/${logoFilename}`;
            setLogo(logoPath);

            // Update preview
            updatePreview();
            console.log('‚úÖ G√©n√©ration termin√©e');
        }

        // ========== UPDATE PREVIEW ==========
        function updatePreview() {
            const nom = document.getElementById('nomEtudiant').value;
            const prenom = document.getElementById('prenomEtudiant').value;
            const nomEtab = document.getElementById('nomEtablissement').value;
            const adresse = document.getElementById('adresseEtablissement').value;
            const dateNaissance = document.getElementById('dateNaissance').value;
            const matiere = document.getElementById('matiere').value;
            const annee = document.getElementById('anneeScolaire').value;
            const directeur = document.getElementById('nomDirecteur').value;
            const ville = document.getElementById('villeSignature').value;
            const dateSign = document.getElementById('dateSignature').value;

            // Calculate age
            let age = 18;
            if (dateNaissance) {
                const birthDate = new Date(dateNaissance);
                const today = new Date();
                age = today.getFullYear() - birthDate.getFullYear();
            }

            // Generate CAF/SS number
            const numImmat = `${randomInt(1, 2)} ${padZero(randomInt(1, 99), 2)} ${padZero(randomInt(1, 12), 2)} ${padZero(randomInt(1, 95), 2)} ${padZero(randomInt(1, 999), 3)} ${padZero(randomInt(1, 999), 3)} ${padZero(randomInt(1, 99), 2)}`;

            // Update certificate header
            document.getElementById('certNomEtab').textContent = nomEtab || 'ACAD√âMIE DE PARIS';
            document.getElementById('certAdresse').textContent = adresse || '12 Boulevard d\'Indochine, 75019 Paris';
            document.getElementById('certAnnee').textContent = annee || '2025 - 2026';

            // Update certificate content
            document.getElementById('certNomPrenom').textContent = `${nom} ${prenom}` || 'NOM Pr√©nom';
            document.getElementById('certAge').textContent = age;
            document.getElementById('certMatiere').textContent = matiere || 'Terminale G√©n√©rale';
            document.getElementById('certDateInscription').textContent = '01/09/2025';
            document.getElementById('certDateExpiration').textContent = '30/06/2026';

            // Director and signature
            const isMaleDirector = directeur.startsWith('M.') || window.currentDirectorIsMale === true;
            document.getElementById('certSoussigne').textContent = isMaleDirector ? 'Directeur' : 'Directrice';
            document.getElementById('certDirecteurIntro').textContent = directeur || 'M. Nom directeur';

            // Student pronouns (il/elle)
            const isMaleStudent = window.currentStudentIsMale === true;
            document.getElementById('certIlElle').textContent = isMaleStudent ? 'le' : 'la';
            document.getElementById('certIlElle2').textContent = isMaleStudent ? 'il' : 'elle';
            document.getElementById('certIlElle3').textContent = isMaleStudent ? 'il' : 'elle';

            // Footer
            document.getElementById('certVille').textContent = ville || 'Paris';
            document.getElementById('certDateSignature').textContent = dateSign ? formatDateFR(dateSign) : '09/12/2025';
            document.getElementById('certNumImmat').textContent = numImmat;

            // Signature cursive
            const signatureName = directeur ? directeur.replace(/^M\.\s*|^Mme\s*/i, '') : 'Signature';
            document.getElementById('certSignature').textContent = signatureName;
        }

        // ========== GENERATE RANDOM K12 ==========
        function generateRandomK12() {
            console.log('üé≤ G√©n√©ration K12 al√©atoire...');

            // Random employee
            const firstName = randomFromArray(k12Data.firstNames);
            const lastName = randomFromArray(k12Data.lastNames);
            const fullName = `${firstName} ${lastName}`;
            const empId = padZero(randomInt(1000, 9999), 6);
            const department = randomFromArray(k12Data.departments);
            const position = randomFromArray(k12Data.positions);
            const school = randomFromArray(k12Data.schools);

            // Random earnings
            const baseSalary = randomInt(4000, 7000);
            const bonus = randomInt(0, 500);
            const overtimeHours = randomInt(0, 20);
            const overtimeRate = randomInt(35, 55);

            // Fill K12 form
            document.getElementById('k12SchoolName').value = school.name;
            document.getElementById('k12SchoolAddress').value = school.address;
            document.getElementById('k12EmpName').value = fullName;
            document.getElementById('k12EmpId').value = empId;
            document.getElementById('k12Department').value = department;
            document.getElementById('k12Position').value = position;
            document.getElementById('k12BaseSalary').value = baseSalary;
            document.getElementById('k12Bonus').value = bonus;
            document.getElementById('k12OvertimeHours').value = overtimeHours;
            document.getElementById('k12OvertimeRate').value = overtimeRate;

            // Update preview
            updateK12Preview();
            console.log('‚úÖ G√©n√©ration K12 termin√©e');
        }

        // ========== UPDATE K12 PREVIEW ==========
        function updateK12Preview() {
            const schoolName = document.getElementById('k12SchoolName').value;
            const schoolAddress = document.getElementById('k12SchoolAddress').value;
            const empName = document.getElementById('k12EmpName').value;
            const empId = document.getElementById('k12EmpId').value;
            const department = document.getElementById('k12Department').value;
            const position = document.getElementById('k12Position').value;
            const baseSalary = parseFloat(document.getElementById('k12BaseSalary').value) || 5000;
            const bonus = parseFloat(document.getElementById('k12Bonus').value) || 0;
            const otHours = parseFloat(document.getElementById('k12OvertimeHours').value) || 0;
            const otRate = parseFloat(document.getElementById('k12OvertimeRate').value) || 40;

            // Calculate earnings
            const otAmount = otHours * otRate;
            const grossPay = baseSalary + bonus + otAmount;

            // Calculate deductions (approximate US rates)
            const fedTax = grossPay * 0.17;
            const stateTax = grossPay * 0.05;
            const socialSecurity = grossPay * 0.062;
            const medicare = grossPay * 0.0145;
            const healthIns = 150;
            const retirement = grossPay * 0.04;
            const totalDeductions = fedTax + stateTax + socialSecurity + medicare + healthIns + retirement;
            const netPay = grossPay - totalDeductions;

            // YTD calculations (assume 2 months)
            const ytdGross = grossPay * 2;
            const ytdDeductions = totalDeductions * 2;
            const ytdNet = netPay * 2;

            // Update school info - display full school name for institutional identification
            document.getElementById('k12Logo').textContent = schoolName;
            document.getElementById('k12CompanyName').textContent = schoolName + ' (New York City)';
            document.getElementById('k12CompanyAddress').textContent = schoolAddress + ' ‚Ä¢ NYC School District';

            // Update employee info
            document.getElementById('k12DisplayName').textContent = empName;
            document.getElementById('k12DisplayId').textContent = empId;
            document.getElementById('k12DisplayDept').textContent = department;
            document.getElementById('k12DisplayPosition').textContent = position;

            // Update pay period - ensure dates are within last 30 days
            const today = new Date();
            const endDate = today;
            const startDate = new Date(today);
            startDate.setDate(today.getDate() - 30); // 30 days ago

            // Format dates as MM/DD/YYYY (US format)
            const formatUSDate = (date) => {
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                const yyyy = date.getFullYear();
                return `${mm}/${dd}/${yyyy}`;
            };

            document.getElementById('k12PayPeriod').textContent = `${formatUSDate(startDate)} ‚Äî ${formatUSDate(endDate)}`;
            document.getElementById('k12PayDate').textContent = formatUSDate(endDate);

            // Update earnings
            document.getElementById('k12DisplaySalary').textContent = `$${baseSalary.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12DisplayOTHours').textContent = otHours;
            document.getElementById('k12DisplayOTRate').textContent = `$${otRate}/hr`;
            document.getElementById('k12DisplayOTAmount').textContent = `$${otAmount.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12DisplayBonus').textContent = `$${bonus.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12TotalEarnings').textContent = `$${grossPay.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;

            // Update deductions
            document.getElementById('k12FedTax').textContent = `$${fedTax.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12StateTax').textContent = `$${stateTax.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12SS').textContent = `$${socialSecurity.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12Medicare').textContent = `$${medicare.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12Health').textContent = `$${healthIns.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12Retirement').textContent = `$${retirement.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12TotalDeductions').textContent = `$${totalDeductions.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;

            // Update YTD and Net Pay
            document.getElementById('k12YTDGross').textContent = `$${ytdGross.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12YTDDeductions').textContent = `$${ytdDeductions.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12YTDNet').textContent = `$${ytdNet.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('k12NetPay').textContent = `$${netPay.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
        }

        // ========== SET LOGO WITH RASTERIZATION ==========
        // Charge le logo depuis Base64 (logos.js), le rasterise en PNG via Canvas
        function setLogo(logoPath) {
            const logoEl = document.getElementById('certLogo');

            // 1. R√©cup√©rer la version Base64 depuis window.CERT_LOGOS
            let source = logoPath;
            if (window.CERT_LOGOS && window.CERT_LOGOS[logoPath]) {
                source = window.CERT_LOGOS[logoPath];
                console.log('üñºÔ∏è Logo trouv√© en Base64:', logoPath);
            } else {
                console.warn('‚ö†Ô∏è Logo non trouv√© en Base64, utilisation chemin direct');
            }

            // 2. Cr√©er une image temporaire
            const img = new Image();

            img.onload = function () {
                // 3. Canvas pour rasteriser
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');

                // 4. Dessiner (rasterization SVG ‚Üí pixels)
                ctx.drawImage(img, 0, 0, 200, 200);

                // 5. Extraire en PNG data URL
                const pngDataUrl = canvas.toDataURL('image/png');

                // 6. Afficher le PNG rasteris√©
                logoEl.innerHTML = `<img src="${pngDataUrl}" alt="Logo" class="h-24 mx-auto">`;
                console.log('‚úÖ Logo rasteris√©');
            };

            img.onerror = function () {
                console.warn('‚ö†Ô∏è Erreur chargement logo');
                logoEl.innerHTML = '<div style="font-size: 20px; font-weight: bold; text-align: center; padding: 20px; color: #1e3a5f;">LOGO</div>';
            };

            img.src = source;
        }

        // ========== DOWNLOAD AS IMAGE ==========
        async function downloadCertificate() {
            // Select the correct element based on current mode
            const elementId = currentMode === 'FR' ? 'certificate' : 'paystub';
            const element = document.getElementById(elementId);
            console.log(`üì• D√©marrage du t√©l√©chargement (mode: ${currentMode})...`);

            try {
                // Capture avec html2canvas
                const canvas = await html2canvas(element, {
                    scale: 3, // Haute r√©solution pour qualit√© A4
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    onclone: function (clonedDoc) {
                        // Fix vertical alignment offset for K12 mode
                        const clonedElement = clonedDoc.getElementById(elementId);
                        if (clonedElement) {
                            // Force line-height and vertical alignment fixes
                            const allElements = clonedElement.querySelectorAll('*');
                            allElements.forEach(el => {
                                // Ensure consistent text rendering
                                el.style.textRendering = 'geometricPrecision';
                            });

                            // Move content up to compensate for html2canvas offset
                            // Note: transform doesn't work with html2canvas, use margin instead
                            const allTableCells = clonedElement.querySelectorAll('td, th');
                            allTableCells.forEach(cell => {
                                cell.style.paddingTop = '3px';
                                cell.style.paddingBottom = '3px';
                            });
                        }
                    }
                });

                // T√©l√©charger avec nom appropri√©
                const link = document.createElement('a');
                let filename;
                if (currentMode === 'FR') {
                    const nom = document.getElementById('nomEtudiant').value || 'certificat';
                    const prenom = document.getElementById('prenomEtudiant').value || '';
                    filename = `certificat_${nom}_${prenom}.png`;
                } else {
                    const empName = document.getElementById('k12EmpName').value || 'paystub';
                    filename = `paystub_${empName.replace(/\s+/g, '_')}.png`;
                }
                link.download = filename.toLowerCase().replace(/\s+/g, '_');
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();

                console.log('‚úÖ T√©l√©chargement r√©ussi');

            } catch (error) {
                console.error('‚ùå Erreur t√©l√©chargement:', error);
                alert('Erreur lors du t√©l√©chargement. V√©rifiez la console (F12) pour plus de d√©tails.');
            }
        }

        // ========== MODE-AWARE HANDLERS ==========
        function handleRandomize() {
            if (currentMode === 'FR') {
                generateRandom();
            } else {
                generateRandomK12();
            }
        }

        function handlePreviewUpdate() {
            if (currentMode === 'FR') {
                updatePreview();
            } else {
                updateK12Preview();
            }
        }

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', function () {
            console.log('‚úÖ Donn√©es int√©gr√©es charg√©es');

            // Setup event listeners
            document.getElementById('randomizeAllBtn').addEventListener('click', handleRandomize);
            document.getElementById('downloadBtn').addEventListener('click', downloadCertificate);

            // Live update on input change for FR form
            const frInputs = document.querySelectorAll('#formFR input, #formFR select');
            frInputs.forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });

            // Live update on input change for K12 form
            const k12Inputs = document.querySelectorAll('#formK12 input, #formK12 select');
            k12Inputs.forEach(input => {
                input.addEventListener('input', updateK12Preview);
                input.addEventListener('change', updateK12Preview);
            });

            // Generate random data on load (FR mode by default)
            generateRandom();
        });
    </script>
</body>

</html>